# Скрипты резервного копирования TDP

## Описание

Два скрипта для создания и восстановления резервных копий Django проекта TDP:

- `backup.sh` - создает резервную копию базы данных и медиа файлов
- `restore.sh` - восстанавливает данные из резервной копии

## Использование

### Создание резервной копии

```bash
./backup.sh
```

Скрипт автоматически:
- Определяет пути к базе данных и медиа файлам из настроек Django
- Создает архив с именем `tdp_DDMMYYYY_HHMMSS.zip`
- Сохраняет архив в папку Загрузки (или на Рабочий стол, если папка Загрузки недоступна)

### Восстановление из резервной копии

#### Интерактивный режим (рекомендуется)
```bash
./restore.sh
```

Скрипт:
- Автоматически найдет все архивы TDP в стандартных местах
- Покажет список с размерами и датами создания
- Позволит выбрать нужный архив или указать путь вручную

#### Прямое указание архива
```bash
./restore.sh ~/Downloads/tdp_14092025_111224.zip
```

#### Предварительный просмотр (dry-run)
```bash
./restore.sh --dry-run
./restore.sh --dry-run ~/Downloads/tdp_14092025_111224.zip
```

## Особенности

### Автоматическое определение путей
Скрипты автоматически определяют правильные пути к базе данных и медиа файлам в зависимости от настроек Django:
- **Разработка**: `db.sqlite3`, `media/`
- **Продакшн**: пути из переменных окружения `DJANGO_DB_NAME` и `DJANGO_MEDIA_ROOT`

### Безопасность
- Перед восстановлением создается резервная копия текущих файлов
- Требуется подтверждение перед восстановлением (кроме режима `--force`)
- Проверка целостности базы данных после восстановления

### Поддерживаемые окружения
- Режим разработки (по умолчанию)
- Продакшн (при установке `DJANGO_SETTINGS_MODULE=config.settings.prod`)

## Примеры

### Создание резервной копии
```bash
# В режиме разработки
./backup.sh

# В продакшн режиме
export DJANGO_SETTINGS_MODULE=config.settings.prod
export DJANGO_DB_NAME=/data/db.sqlite3
export DJANGO_MEDIA_ROOT=/app/media
./backup.sh
```

### Восстановление
```bash
# Интерактивный выбор
./restore.sh

# Прямое указание файла
./restore.sh ~/Downloads/tdp_14092025_111224.zip

# Предварительный просмотр
./restore.sh --dry-run

# Принудительное восстановление
./restore.sh --force ~/Downloads/tdp_14092025_111224.zip
```

## Структура архива

```
tdp_DDMMYYYY_HHMMSS.zip
├── db.sqlite3          # База данных
├── media/              # Медиа файлы
│   ├── tours/
│   ├── services/
│   ├── reviews/
│   └── ...
└── backup_info.txt     # Информация о резервной копии
```

## Требования

- Bash 4.0+
- Python 3.6+
- Django 3.0+
- Команды: `zip`, `unzip`, `du`, `stat`
