{% extends "base.html" %}
{% block after_header %}<div class="header-spacer" aria-hidden="true"></div>{% endblock %}
{% load static %}

{% block title %}Услуги{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'styles/tours.css' %}">
  <link rel="stylesheet" href="{% static 'styles/slide.css' %}">
{% endblock %}

{% block body_class %}has-inner-hero{% endblock %}

{% block content %}
<section class="home slide slide--inner">
  <div class="home_slider_container">
  <div class="background_image" style="background-image: url('{% static "images/home_slider.jpg" %}');"></div>

    <div class="home_slider_content_container">
      <div class="hero hero--inner">
        <div class="container hero__grid">
          <div class="hero-left">
            <h1 class="hero-title">Услуги на Пхукете</h1>
            <p class="hero-sub">Выберите услугу и оставьте заявку — мы ответим вам в течение 10–15 минут.</p>
          </div>

          <div class="hero-right">
            <button class="btn-hero open-lead-modal"
                    data-cta="Inner Hero — Услуги"
                    type="button">Оставить заявку</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="container my-4">

  {# ===== ФИЛЬТРЫ (по образцу tours) ===== #}
  <section class="t-filters">
    <div class="container">
      <form class="t-filters__form" method="get" action="{% url 'services:list' %}">
        <div class="t-filters__Row">
          <div class="t-filters__search">
            <i class="fa fa-search"></i>
            <input type="search" name="q" value="{{ request.GET.q }}" placeholder="Поиск по названию, описанию">
          </div>
          <div class="t-filters__price">
            <label>Цена,</label>
            <input type="number" name="price_min" value="{{ request.GET.price_min }}" min="0" placeholder="от">
            <span>—</span>
            <input type="number" name="price_max" value="{{ request.GET.price_max }}" min="0" placeholder="до">
          </div>
          <div class="t-filters__sort">
            <label>Сортировка</label>
            <select name="sort" onchange="this.form.submit()">
              <option value="" {% if not request.GET.sort %}selected{% endif %}>По умолчанию</option>
              <option value="price_asc"  {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Цена ↑</option>
              <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Цена ↓</option>
              <option value="newest"     {% if request.GET.sort == 'newest' %}selected{% endif %}>Сначала новые</option>
            </select>
          </div>
          <div class="t-filters__submit">
            <button class="order_btn" type="submit">Показать</button>
          </div>
        </div>

        {% if categories %}
          <div class="t-filters__pills">
            <a href="{% url 'services:list' %}" class="pill {% if not active_category %}is-active{% endif %}">Все</a>
            {% for c in categories %}
              <a href="{% url 'services:by_category' slug=c.slug %}"
                 class="pill {% if active_category and active_category.id == c.id %}is-active{% endif %}">
                {{ c.name }}{% if c.items %}<span class="pill__count">{{ c.items }}</span>{% endif %}
              </a>
            {% endfor %}
          </div>
        {% endif %}
      </form>
    </div>
  </section>


  <div class="row">
    <div class="col-lg-8 col-xl-9">
      <div class="row">
        {% for s in services %}
          <div class="col-md-4 mb-4">
            <a href="{{ s.get_absolute_url }}" class="card h-100 text-decoration-none">
              {% if s.cover %}
                <img src="{{ s.cover.url }}" class="card-img-top" alt="{{ s.title }}">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ s.title }}</h5>
                {% if s.short_desc %}<p class="card-text">{{ s.short_desc|truncatechars:140 }}</p>{% endif %}
                <div class="small text-muted">
                  <span>Цена: {{ s.price_adult|floatformat:0 }} сом</span>
                  {% if s.price_child %} · <span>Дополнительные услуги: {{ s.price_child|floatformat:0 }} сом</span>
                  {% elif s.price_extra %} · <span>Дополнительные услуги: {{ s.price_extra|floatformat:0 }} сом</span>{% endif %}
                </div>
              </div>
            </a>
          </div>
        {% empty %}
          <div class="col-12"><p>Пока нет услуг.</p></div>
        {% endfor %}
      </div>
    </div>

    <aside class="col-lg-4 col-xl-3 t-aside">
      {% if categories %}
        <div class="t-aside__box">
          <div class="t-aside__title">Категории</div>
          <ul class="t-aside__list">
            {% for c in categories %}
              <li><a href="{% url 'services:by_category' slug=c.slug %}">{{ c.name }}{% if c.items %} <span class="text-muted">({{ c.items }})</span>{% endif %}</a></li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      {% if tags %}
        <div class="t-aside__box">
          <div class="t-aside__title">Теги</div>
          <div class="t-aside__tags">
            {% for tg in tags %}
              <a href="{% url 'services:by_tag' slug=tg.slug %}">#{{ tg.name }}</a>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if popular_services %}
        <div class="t-aside__box">
          <div class="t-aside__title">Популярные</div>
          <ul class="t-aside__popular">
            {% for p in popular_services %}
              <li>
                <a href="{{ p.get_absolute_url }}">{% if p.cover %}<img src="{{ p.cover.url }}" alt="{{ p.title }}">{% endif %} {{ p.title }}</a>
                <div class="small text-muted">{{ p.price_adult|floatformat:0 }}</div>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </aside>
  </div>
</div>
{% endblock %}
