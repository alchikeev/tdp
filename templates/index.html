{% extends 'base.html' %}
{% load static %}

{% block title %}Главная — Thai Dream Phuket{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'styles/how-it-works.css' %}">
  <link rel="stylesheet" href="{% static 'styles/index.css' %}">
{% endblock %}

{% block content %}

  <!-- Home / Hero -->
  <section class="home">
    <div class="home_slider_container">
  <div class="background_image" style="background-image:url({% static 'images/home_slider.jpg' %})"></div>

      <div class="home_slider_content_container">
        <div class="hero">
          <div class="hero-left">
            <h1 class="hero-title">Откройте Пхукет вместе с нами</h1>
            <p class="hero-sub">Проверенные маршруты, удобный трансфер и прозрачные цены — оставьте заявку, и мы подберём идеальный тур.</p>
            <div class="hero-cta">
              <button class="btn-hero open-lead-modal" data-cta="Hero — Оставить заявку" type="button">Оставить заявку</button>
            </div>
          </div>

          <!-- Парящие облака справа (desktop) -->
          <div class="hero-clouds">
            <div class="cloud c1" data-w="wide">
              <i class="icon fa fa-id-card-o"></i>
              <span>Лицензия</span>
            </div>
            <div class="cloud c2">
              <i class="icon fa fa-shield"></i>
              <span>Страховка</span>
            </div>
            <div class="cloud c3">
              <i class="icon fa fa-star"></i>
              <span>Рейтинг 4.9/5</span>
            </div>
            <div class="cloud c4">
              <i class="icon fa fa-bus"></i>
              <span>Трансфер от отеля</span>
            </div>
            <div class="cloud c5">
              <i class="icon fa fa-child"></i>
              <span>Скидки для детей</span>
            </div>
          </div>

          <!-- Угловая плашка -->

        </div>
      </div>
    </div>
  </section>
  

  <!-- Tours grid on homepage -->
  <section class="container my-5">
    <div class="row">
      
      <!-- Categories -->
      <div class="col-12 mb-4">
        <div class="home-categories">
          <button class="home-category-btn active" onclick="showAllTours()">
            Все туры
            <span class="category-count">({{ total_tours_count }})</span>
          </button>
          {% for category in parent_categories %}
            <button class="home-category-btn" 
                    data-category-id="{{ category.id }}"
                    onclick="toggleSubcategories({{ category.id }})">
              {{ category.name }}
              <span class="category-count">({{ category.tours_count }})</span>
            </button>
          {% endfor %}
        </div>
        
        <!-- Subcategories (hidden by default) -->
        <div class="home-subcategories" id="subcategories-container" style="display: none;">
          <div class="subcategories-content"></div>
        </div>
      </div>
      
      <!-- Tours Grid -->
      <div class="col-12">
        <div class="tours-grid">
          {% for t in tours %}
            <div class="tour-card-wrapper">
              <div class="home-tour-card" 
                   style="background-image: url({% if t.cover %}{{ t.cover.url }}{% else %}{% static 'images/travello.jpg' %}{% endif %});"
                   onclick="location.href='{{ t.get_absolute_url }}'">
                
                <!-- Top badges and rating -->
                <div class="home-tour-card__top">
                  {% if t.is_popular %}<span class="home-tour-badge home-tour-badge--hit">Хит</span>{% endif %}
                  {% if t.has_discount %}<span class="home-tour-badge home-tour-badge--discount">Скидка</span>{% endif %}
                  <div class="home-tour-rating">
                    <i class="fa fa-star"></i>
                    <span>{{ t.rating|default:"4.5" }}</span>
                  </div>
                </div>

                <!-- Bottom content -->
                <div class="home-tour-card__bottom">
                  <h3 class="home-tour-title">{{ t.title|upper }}</h3>
                  <div class="home-tour-meta">
                    {% if t.location %}<span class="home-tour-location">{{ t.location }}</span>{% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% empty %}
            <div class="no-tours"><p>Пока нет туров.</p></div>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>

  <div class="container text-center mb-5">
    <a href="{% url 'tours:list' %}" class="btn btn-outline-primary">Смотреть ещё экскурсии</a>
  </div>

  <!-- Services grid on homepage -->
  <section class="container my-5">
    <div class="row">
      <div class="col-12 mb-3">
        <h2>Услуги</h2>
      </div>
      {% for s in services %}
        <div class="col-md-4 mb-4">
          <div class="home-tour-card" 
               style="background-image: url({% if s.cover %}{{ s.cover.url }}{% else %}{% static 'images/travello.jpg' %}{% endif %});"
               onclick="location.href='{{ s.get_absolute_url }}'">
            
            <!-- Top badges -->
            <div class="home-tour-card__top">
              <div class="home-tour-badge home-tour-badge--service">Услуга</div>
            </div>

            <!-- Bottom content -->
            <div class="home-tour-card__bottom">
              <h3 class="home-tour-title">{{ s.title|upper }}</h3>
              <div class="home-tour-meta">
                <span class="home-tour-location">Цена: {{ s.price_adult|floatformat:0 }} сом</span>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12"><p>Пока нет услуг.</p></div>
      {% endfor %}
    </div>
  </section>

  <div class="container text-center mb-5">
    <a href="{% url 'services:list' %}" class="btn btn-outline-primary">Смотреть ещё услуги</a>
  </div>

  <!-- Intro -->
  <section class="intro">
  <div class="intro_background" style="background-image:url({% static 'images/intro.png' %})"></div>
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="intro_container">
            <div class="row">
              <div class="col-lg-4 intro_col">
                <div class="intro_item d-flex flex-row align-items-end justify-content-start">
                  <div class="intro_icon"><img src="{% static 'images/beach.svg' %}" alt=""></div>
                  <div class="intro_content">
                    <div class="intro_title">Популярные направления</div>
                    <div class="intro_subtitle"><p>Лучшие места и проверенные маршруты для комфортного отдыха.</p></div>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 intro_col">
                <div class="intro_item d-flex flex-row align-items-end justify-content-start">
                  <div class="intro_icon"><img src="{% static 'images/wallet.svg' %}" alt=""></div>
                  <div class="intro_content">
                    <div class="intro_title">Выгодные цены</div>
                    <div class="intro_subtitle"><p>Прозрачная ценовая политика и специальные предложения.</p></div>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 intro_col">
                <div class="intro_item d-flex flex-row align-items-end justify-content-start">
                  <div class="intro_icon"><img src="{% static 'images/suitcase.svg' %}" alt=""></div>
                  <div class="intro_content">
                    <div class="intro_title">Удобный сервис</div>
                    <div class="intro_subtitle"><p>Поддержка на всех этапах — от бронирования до возвращения в отель.</p></div>
                  </div>
                </div>
              </div>
            </div><!-- /.row -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="testimonials" id="testimonials">
  <div class="parallax_background parallax-window" data-parallax="scroll" data-image-src="{% static 'images/reviews_bg.jpg' %}" data-speed="0.8" style="background-image:url({% static 'images/reviews_bg.jpg' %}); background-size:cover; background-position:center;"></div>
    <div class="container">
      <div class="row">
        <div class="col text-center">
          <div class="section_subtitle">Отзывы наших гостей</div>
        </div>
      </div>

      <div class="reviews-grid">
        {% for r in reviews|slice:":6" %}
          <article class="review-card" tabindex="0" aria-labelledby="rev-{{ forloop.counter }}-author">
            <div class="review-card-inner">
              <header class="review-head">
                <div class="review-author" id="rev-{{ forloop.counter }}-author">{{ r.name }}</div>
                <div class="review-meta">
                  <time datetime="{{ r.created_at|date:'c' }}">{{ r.created_at|date:'d.m.Y' }}</time>
                  {% with r.rating|default:5 as rating %}
                    <div class="review-rating" aria-label="Рейтинг {{ rating }} из 5">
                      {% for _ in "12345" %}
                        {% if forloop.counter <= rating %}
                          <span class="star active" aria-hidden="true">★</span>
                        {% else %}
                          <span class="star" aria-hidden="true">★</span>
                        {% endif %}
                      {% endfor %}
                    </div>
                  {% endwith %}
                </div>
              </header>

              <div class="review-body">
                <p class="review-text">{{ r.message }}</p>
              </div>

              {% if r.image %}
                <div class="review-photos">
                  <img src="{{ r.image.url }}" alt="Фото от {{ r.name }}" loading="lazy">
                </div>
              {% endif %}

            </div>
          </article>
        {% empty %}
          <p>Пока нет отзывов.</p>
        {% endfor %}
      </div>

      <div class="reviews-cta text-center mt-4">
        <a href="{% url 'reviews:list' %}" class="btn btn-primary reviews-all">Смотреть все отзывы</a>
      </div>

    </div>
    <div class="test_nav">
      <ul class="d-flex flex-column align-items-end justify-content-end">
        <li><a href="#">City Breaks Clients<span>01</span></a></li>
        <li><a href="#">Cruises Clients<span>02</span></a></li>
        <li><a href="#">All Inclusive Clients<span>03</span></a></li>
      </ul>
    </div>
  </section>

  <!-- News -->
  <section class="news py-5" id="news">
    <div class="container">
      <h2 class="mb-4">Новости</h2>
      <div class="row">
        {% for post in news_posts %}
          <div class="col-md-4 mb-4">
            <a href="{{ post.get_absolute_url }}" class="card h-100 text-decoration-none">
              {% if post.cover %}
                <img src="{{ post.cover.url }}" class="card-img-top" alt="{{ post.title }}">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ post.title }}</h5>
                <div class="small text-muted">{{ post.pub_date|date:"d.m.Y" }}</div>
                <p class="card-text">{{ post.content|truncatechars:120 }}</p>
              </div>
            </a>
          </div>
        {% empty %}
          <div class="col-12"><p>Пока нет новостей.</p></div>
        {% endfor %}
      </div>
      <div class="text-center mt-4">
        <a href="{% url 'news:list' %}" class="btn btn-outline-primary">Смотреть все новости</a>
      </div>
    </div>
  </section>

  <!-- Blog -->
  <section class="blog py-5 bg-light" id="blog">
    <div class="container">
      <h2 class="mb-4">Блог</h2>
      <div class="row">
        {% for post in blog_posts %}
          <div class="col-md-4 mb-4">
            <a href="{{ post.get_absolute_url }}" class="card h-100 text-decoration-none">
              {% if post.cover %}
                <img src="{{ post.cover.url }}" class="card-img-top" alt="{{ post.title }}">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ post.title }}</h5>
                <div class="small text-muted">{{ post.pub_date|date:"d.m.Y" }}</div>
                <p class="card-text">{{ post.content|truncatechars:120 }}</p>
              </div>
            </a>
          </div>
        {% empty %}
          <div class="col-12"><p>Пока нет статей.</p></div>
        {% endfor %}
      </div>
      <div class="text-center mt-4">
        <a href="{% url 'blog:list' %}" class="btn btn-outline-primary">Смотреть все статьи</a>
      </div>
    </div>
  </section>

  <!-- How it works / Conversion block -->
  <section id="how-it-works" class="how-it-works">
    <div class="container">
      <div class="how-it-works-header">
        <div class="how-it-works-subtitle">Как это работает</div>
        <h2 class="how-it-works-title">Бронь за 4 шага — быстро и просто</h2>
        <p class="how-it-works-description">Вы оставляете заявку, мы подтверждаем наличие мест, договор и оплата — готово. Ниже показаны этапы — можно перейти на любой.</p>
      </div>

      <div class="how-it-works-content">
        <!-- Steps Section -->
        <div class="how-it-works-steps">
          <div class="steps-container">
            <div class="steps-progress-line"></div>
            
            <div class="step-item active">
              <div class="step-number">1</div>
              <div class="step-content">
                <div class="step-icon">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 9H14V4H5V21H19V9Z" fill="#E76700"/>
                  </svg>
                </div>
                <h3 class="step-title">Оставляете заявку</h3>
                <p class="step-description">Заполните форму или нажмите «Оставить заявку» — мы получим заявку в CRM.</p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">2</div>
              <div class="step-content">
                <div class="step-icon">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12S6.48 22 12 22 22 17.52 22 12 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="#E76700"/>
                  </svg>
                </div>
                <h3 class="step-title">Подтверждаем детали</h3>
                <p class="step-description">Наш менеджер уточнит время, трансфер и дополнительные пожелания.</p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">3</div>
              <div class="step-content">
                <div class="step-icon">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12S6.48 22 12 22 22 17.52 22 12 17.52 2 12 2ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="#E76700"/>
                  </svg>
                </div>
                <h3 class="step-title">Оплата и подтверждение</h3>
                <p class="step-description">Вы оплачиваете удобным способом, мы присылаем подтверждение и ваучеры.</p>
              </div>
            </div>

            <div class="step-item">
              <div class="step-number">4</div>
              <div class="step-content">
                <div class="step-icon">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" fill="#E76700"/>
                  </svg>
                </div>
                <h3 class="step-title">Отдых и поддержка</h3>
                <p class="step-description">Мы остаёмся на связи и помогаем на месте при необходимости.</p>
              </div>
            </div>
          </div>

          <!-- Navigation Controls -->
          <div class="steps-navigation">
            <button type="button" class="step-nav-btn" data-action="prev" aria-label="Предыдущий шаг">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.41 7.41L14 6L8 12L14 18L15.41 16.59L10.83 12L15.41 7.41Z"/>
              </svg>
            </button>
            
            <div class="steps-dots">
              <div class="step-dot active"></div>
              <div class="step-dot"></div>
              <div class="step-dot"></div>
              <div class="step-dot"></div>
            </div>
            
            <button type="button" class="step-nav-btn" data-action="next" aria-label="Следующий шаг">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8.59 16.59L10 18L16 12L10 6L8.59 7.41L13.17 12L8.59 16.59Z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Form Section -->
        <div class="how-it-works-form">
          <div class="form-header">
            <h3 class="form-title">Оставьте заявку прямо сейчас</h3>
            <p class="form-subtitle">Получите персональное предложение за 5 минут</p>
          </div>
          
          <form class="hiw-form" method="post" action="{% url 'core:lead_create' %}" novalidate>
            {% csrf_token %}
            <input type="hidden" name="source_page" value="how-it-works">
            <input type="hidden" name="cta" value="how-it-works-form">
            
            <div class="form-group">
              <label for="hiw_name" class="form-label">Имя</label>
              <input id="hiw_name" name="name" type="text" class="form-input" required>
            </div>
            
            <div class="form-group">
              <label for="hiw_phone" class="form-label">Телефон</label>
              <input id="hiw_phone" name="phone" type="tel" class="form-input" inputmode="tel" pattern="[\d\+\-\s\(\)]{8,18}" required>
            </div>
            
            <div class="form-group">
              <label for="hiw_msg" class="form-label">Комментарий (необязательно)</label>
              <textarea id="hiw_msg" name="message" class="form-input form-textarea" rows="3"></textarea>
            </div>
            
            <button id="hiw_submit" type="submit" class="form-submit">Отправить заявку</button>
            
            <div class="form-message success" id="hiw_success" role="status" aria-live="polite" hidden>
              Спасибо! Заявка принята — мы свяжемся в ближайшее время.
            </div>
            <div class="form-message error" id="hiw_error" role="alert" aria-live="assertive" hidden>
              Не удалось отправить заявку. Пожалуйста, попробуйте ещё раз или напишите в WhatsApp.
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

{% endblock %}

{% block extra_js %}
  {# Google Analytics example (replace ID) #}
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
      // AJAX submission for How-it-works form
      function initHiwForm(){
        var form = document.querySelector('.hiw-form');
        if (!form) return;
        var submit = document.getElementById('hiw_submit');
        var success = document.getElementById('hiw_success');
        var error = document.getElementById('hiw_error');

        function show(el){ if (!el) return; el.hidden = false; }
        function hide(el){ if (!el) return; el.hidden = true; }

        form.addEventListener('submit', async function(e){
          e.preventDefault();
          hide(success); hide(error);
          if (submit) { submit.disabled = true; submit.textContent = 'Отправка...'; }

          // basic client validation
          var name = form.querySelector('[name="name"]').value.trim();
          var phone = form.querySelector('[name="phone"]').value.trim();
          if (!name || !phone){ show(error); error.textContent = 'Пожалуйста, укажите имя и телефон.'; if (submit){ submit.disabled=false; submit.textContent='Отправить заявку'; } return; }

          var fd = new FormData(form);
          try{
            var resp = await fetch(form.action, { method:'POST', body: fd, headers: {'X-Requested-With':'XMLHttpRequest'} });
            if (!resp.ok) throw new Error('network');
            var data = await resp.json();
            if (data && data.ok){
              show(success);
              form.reset();
            } else {
              show(error);
            }
          }catch(err){
            show(error);
          }finally{
            if (submit){ submit.disabled = false; submit.textContent = 'Отправить заявку'; }
          }
        }, false);
      }

      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initHiwForm);
      else initHiwForm();

    gtag('js', new Date());
    gtag('config', 'UA-23581568-13');
  </script> -->

  {# REVIEWS SECTION: inline script to animate cards on scroll (uses IntersectionObserver) #}
  <script>
    (function(){
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      function onReady(){
        var cards = document.querySelectorAll('.review-card');
        if (!cards.length) return;
        var io = new IntersectionObserver(function(entries){
          entries.forEach(function(e){ if (e.isIntersecting) { e.target.classList.add('is-visible'); io.unobserve(e.target); } });
        }, { threshold: 0.12 });
        cards.forEach(function(c,i){ c.style.transitionDelay = (i*80)+'ms'; io.observe(c); });
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', onReady);
      else onReady();
    })();
  </script>
  <!-- HOW IT WORKS: now handled by how-it-works.js -->
  <script>
    (function(){
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      var isMobile = /Mobi|Android/i.test(navigator.userAgent) || window.innerWidth < 768;
      if (isMobile) return; // skip on small screens

      var nodes = document.querySelectorAll('.parallax_background');
      if (!nodes.length) return;

      var ticking = false;
      function onScroll(){ if (!ticking){ window.requestAnimationFrame(update); ticking = true; } }

      function update(){
        var top = window.pageYOffset || document.documentElement.scrollTop;
        nodes.forEach(function(n){
          var speed = parseFloat(n.getAttribute('data-speed')) || 0.6;
          // calculate translateY (negative to move slower than page)
          var y = Math.round(top * (1 - speed));
          n.style.transform = 'translate3d(0,' + y + 'px, 0)';
        });
        ticking = false;
      }

      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', function(){ if (window.innerWidth < 768) { nodes.forEach(function(n){ n.style.transform='none'; }); window.removeEventListener('scroll', onScroll); } }, { passive: true });
      // initial frame
      update();
    })();
  </script>
  <script src="{% static 'js/how-it-works.js' %}"></script>
  
  <!-- Categories functionality -->
  <script>
    function toggleSubcategories(categoryId) {
      const container = document.getElementById('subcategories-container');
      const content = container.querySelector('.subcategories-content');
      const btn = document.querySelector(`[data-category-id="${categoryId}"]`);
      
      // Toggle active state
      document.querySelectorAll('.home-category-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Filter tours by category
      filterToursByCategory(categoryId);
      
      // Show/hide subcategories
      if (container.style.display === 'none') {
        // Load subcategories via AJAX
        fetch(`/api/categories/${categoryId}/subcategories/`)
          .then(response => response.json())
          .then(data => {
            content.innerHTML = data.html;
            container.style.display = 'block';
          })
          .catch(error => {
            console.error('Error loading subcategories:', error);
          });
      } else {
        container.style.display = 'none';
        btn.classList.remove('active');
        // Show all tours when hiding subcategories
        showAllTours();
      }
    }
    
    function filterToursByCategory(categoryId) {
      // Load filtered tours via AJAX
      fetch(`/api/categories/${categoryId}/tours/`)
        .then(response => response.json())
        .then(data => {
          updateToursGrid(data.tours);
        })
        .catch(error => {
          console.error('Error loading tours:', error);
        });
    }
    
    function showAllTours() {
      // Set active state
      document.querySelectorAll('.home-category-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.home-category-btn[onclick="showAllTours()"]').classList.add('active');
      
      // Hide subcategories
      const container = document.getElementById('subcategories-container');
      container.style.display = 'none';
      
      // Load all tours via AJAX
      fetch('/api/tours/all/')
        .then(response => response.json())
        .then(data => {
          updateToursGrid(data.tours);
        })
        .catch(error => {
          console.error('Error loading all tours:', error);
        });
    }
    
    function updateToursGrid(tours) {
      const toursContainer = document.querySelector('.tours-grid');
      if (!toursContainer) return;
      
      toursContainer.innerHTML = '';
      
      tours.forEach(tour => {
        const tourCard = createTourCard(tour);
        toursContainer.appendChild(tourCard);
      });
    }
    
    function createTourCard(tour) {
      const wrapper = document.createElement('div');
      wrapper.className = 'tour-card-wrapper';
      
      const card = document.createElement('div');
      card.className = 'home-tour-card';
      card.style.backgroundImage = `url(${tour.cover || '/static/images/travello.jpg'})`;
      card.onclick = () => window.location.href = tour.url;
      
      card.innerHTML = `
        <div class="home-tour-card__top">
          ${tour.is_popular ? '<span class="home-tour-badge home-tour-badge--hit">Хит</span>' : ''}
          ${tour.has_discount ? '<span class="home-tour-badge home-tour-badge--discount">Скидка</span>' : ''}
          <div class="home-tour-rating">
            <i class="fa fa-star"></i>
            <span>${tour.rating || '4.5'}</span>
          </div>
        </div>
        <div class="home-tour-card__bottom">
          <h3 class="home-tour-title">${tour.title.toUpperCase()}</h3>
          <div class="home-tour-meta">
            ${tour.location ? `<span class="home-tour-location">${tour.location}</span>` : ''}
          </div>
        </div>
      `;
      
      wrapper.appendChild(card);
      return wrapper;
    }
  </script>
{% endblock %}

